# Mosquitto 2.x production configuration (optimized for WS via Nginx)
persistence true
persistence_location /var/lib/mosquitto/
persistence_file mosquitto.db
autosave_interval 1800
autosave_on_changes false

max_inflight_messages 50
max_inflight_bytes 64m
max_queued_messages 2000
max_queued_bytes 256m
queue_qos0_messages false
message_size_limit 8m

set_tcp_nodelay true
max_keepalive 120
max_connections -1

log_timestamp true
connection_messages false
log_type error
log_type warning
log_type notice
log_type all
log_dest syslog
log_dest file /var/log/mosquitto/mosquitto.log

per_listener_settings true

# Backend TCP listener (loopback by default)
listener 1883 127.0.0.1
protocol mqtt
allow_anonymous false
password_file /etc/mosquitto/passwd
acl_file /etc/mosquitto/acl

# WebSockets listener (loopback; exposed via Nginx /mqtt)
listener 8083 127.0.0.1
protocol websockets
http_dir /usr/share/mosquitto/www
allow_anonymous false
password_file /etc/mosquitto/passwd
acl_file /etc/mosquitto/acl

# Optional dynamic security plugin
# plugin /usr/lib/mosquitto_dynamic_security.so
# plugin_opt_config_file /etc/mosquitto/dynamic-security.json

include_dir /etc/mosquitto/conf.d
